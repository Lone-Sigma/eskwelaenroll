<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enrollment Portal Login</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- GLOBAL STYLES & VARIABLES (Light Mode with Green/Teal Palette) --- */
      :root {
        /* Base Colors - Adjusted for Light Mode */
        --primary: #007769; /* Dark Teal Green */
        --primary-light: #00b4a5; /* Bright Teal */
        --secondary: #38a3a5; /* Mid Teal */
        --danger: #ef476f;
        --dark: #2d3748; /* Dark text/headers */
        --light: #ffffff; /* Card/Surface white */
        --border: #e9ecef;
        --text: var(--dark); /* Main text color */
        --text-light: #718096; /* Light gray text/labels */
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --radius: 10px;
        --radius-sm: 6px;
        --transition: all 0.3s ease;

        /* Background Colors (Light Theme) */
        --hero-bg-gradient-start: #f5f7fa; /* Very Light Gray */
        --hero-bg-gradient-end: #ffffff; /* White */
        --accent-color: #57cc99; /* Light Mint/Accent Green */
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        /* Light mode background gradient */
        background: linear-gradient(
          135deg,
          var(--hero-bg-gradient-start) 0%,
          var(--hero-bg-gradient-end) 100%
        );
        color: var(--text); /* Dark text on light background */
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: auto;
        padding: 20px;
      }

      /* --- HEADER STYLES --- */
      .header {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        /* White background for light theme header */
        background-color: var(--light); 
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 100;
      }

      .logo a {
        font-size: 24px;
        font-weight: 700;
        color: var(--dark); /* Dark logo text */
        text-decoration: none;
        letter-spacing: -0.5px;
      }

      .logo-icon {
        font-size: 32px;
        margin-right: 10px;
        color: var(--accent-color);
        /* Multi-layer text shadow for depth effect */
        text-shadow: 
            1px 1px 0 var(--secondary),
            2px 2px 0 var(--primary-light),
            3px 3px 5px rgba(0, 0, 0, 0.3); 
        transition: transform 0.3s ease;
      }

      .logo a:hover .logo-icon {
          transform: scale(1.05);
      }
      
      .logo a:hover {
          color: var(--primary);
      }

      .nav-links {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .btn {
        padding: 8px 18px;
        border-radius: var(--radius-sm);
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
        border: 1px solid transparent;
        font-size: 14px;
        cursor: pointer;
        box-shadow: var(--shadow);
      }
      
      .btn-outline {
        color: var(--dark); /* Dark text for outline button */
        border-color: var(--border);
        background-color: transparent;
      }

      .btn-outline:hover {
        background-color: var(--border);
        border-color: var(--text-light);
      }

      .btn-primary {
        /* Accent color gradient remains */
        background: linear-gradient(
          90deg,
          var(--accent-color) 0%,
          var(--primary-light) 100%
        );
        color: var(--dark); /* Dark text on bright button */
        border: none;
        box-shadow: 0 4px 15px rgba(87, 204, 153, 0.4);
      }

      .btn-primary:hover {
        background: linear-gradient(
          90deg,
          var(--primary-light) 0%,
          var(--accent-color) 100%
        );
        box-shadow: 0 6px 20px rgba(87, 204, 153, 0.6);
        transform: translateY(-2px);
      }

      /* --- LOGIN CARD STYLES --- */
      .login-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 420px;
        /* White card background */
        background-color: var(--light);
        border-radius: var(--radius);
        padding: 40px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); /* Softer shadow for light mode */
        border: 1px solid var(--border);
        margin-top: 80px;
      }

      .login-container h2 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--dark);
        text-align: center; /* CENTERING THE WELCOME TEXT */
      }

      .login-container p {
        font-size: 16px;
        color: var(--text-light);
        margin-bottom: 30px;
      }

      .login-container a {
        color: var(--primary); /* Use primary dark green for links */
        text-decoration: none;
        font-weight: 600;
        transition: color var(--transition);
      }

      .login-container a:hover {
        color: var(--primary-light);
        text-decoration: underline;
      }

      .login-form {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .input-group {
        width: 100%;
      }

      .input-group label {
        display: block;
        color: var(--text-light);
        font-size: 14px;
        margin-bottom: 5px;
      }

      .input-group input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        background-color: var(--light);
        color: var(--text);
        font-size: 16px;
        transition: border-color var(--transition), box-shadow var(--transition);
      }

      .input-group input:focus {
        outline: none;
        border-color: var(--primary-light);
        box-shadow: 0 0 0 3px rgba(87, 204, 153, 0.5); 
      }

      .login-button {
        margin-top: 10px;
        width: 100%;
        padding: 15px;
        font-size: 18px;
        font-weight: 700;
        border-radius: var(--radius);
        border: none;
        cursor: pointer;
        /* Inherit btn-primary gradient */
        background: linear-gradient(
          90deg,
          var(--accent-color) 0%,
          var(--primary-light) 100%
        );
        color: var(--dark);
        transition: var(--transition);
        box-shadow: 0 8px 20px rgba(87, 204, 153, 0.5);
      }

      .login-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(87, 204, 153, 0.7);
      }

      /* --- MEDIA QUERIES --- */
      @media (max-width: 600px) {
        .header {
          flex-direction: column;
          gap: 15px;
          padding: 15px 20px;
        }
        .nav-links {
            width: 100%;
            justify-content: space-around;
        }
        .logo a {
            font-size: 20px;
        }
        .logo-icon {
            font-size: 24px;
        }
        .card h2 {
            font-size: 24px;
        }
        .btn, .nav-links a {
            flex-grow: 1;
            text-align: center;
        }
        .role-selection {
            grid-template-columns: 1fr; /* Stack roles on small screens */
        }
        .input-row {
            flex-direction: column;
            gap: 0;
        }
      }

      @media (max-width: 480px) {
        .login-container {
          padding: 30px 20px;
          margin-top: 120px;
          box-shadow: none; 
          border: none;
        }
        .header {
          flex-direction: column;
          gap: 10px;
        }
        .nav-links {
          width: 100%;
          justify-content: space-around;
        }
        .login-container h2 {
            font-size: 24px;
        }
      }
    </style>
  </head>
  <body>
    <!-- HEADER NAVIGATION -->
    <header class="header">
      <div class="logo">
        <!-- Unique 3D-effect logo -->
        <a href="#" id="logo-home">
            <i class="fas fa-users-gear logo-icon"></i>
            EduStaff Hub
        </a>
      </div>
      <!-- NAVIGATION LINKS: Home is a button, Sign Up is primary -->
      <nav class="nav-links" id="main-nav">
        <a href="/adminview/dashboard.html" class="btn btn-outline" id="nav-home">Home</a>
        <a href="register.html" class="btn btn-primary" id="btn-signup">Sign Up</a>
      </nav>
    </header>

    <!-- LOGIN CONTAINER -->
    <div class="login-container">
      <h2>Welcome to Enrollment System</h2>
      <p>Not yet registered? <a href="register.html">Sign Up</a></p>

      <form id="login-form" class="login-form" onsubmit="handleLogin(event)">
        <div class="input-group">
          <label for="username">Username (Email)</label>
          <input
            type="email"
            id="username"
            name="username"
            required
            placeholder="Enter your email"
          />
        </div>

        <div class="input-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="Enter your password"
          />
        </div>

        <button type="submit" class="login-button">Login</button>
      </form>

      <!-- Message area for success/error -->
      <div id="message-area" style="margin-top: 20px; color: var(--primary); font-weight: 600;"></div>
    </div>

    <!-- FIREBASE AND AUTHENTICATION SETUP -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import { getAuth, signInAnonymously, signInWithCustomToken, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
      import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

      // Set Firebase log level to Debug
      setLogLevel('Debug');

      // Global variables provided by the Canvas environment
      const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
      const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
      const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

      let app;
      let auth;
      let db;

      const messageArea = document.getElementById('message-area');

      // 1. Initialize Firebase
      try {
        app = initializeApp(firebaseConfig);
        auth = getAuth(app);
        db = getFirestore(app);
      } catch (e) {
        console.error("Firebase initialization failed:", e);
        messageArea.textContent = "Error: Firebase service initialization failed.";
      }

      // 2. Handle Initial Authentication
      const authenticateUser = async () => {
        try {
          if (initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken);
            console.log("Signed in with custom token.");
          } else {
            // Sign in anonymously if no custom token is available
            await signInAnonymously(auth);
            console.log("Signed in anonymously.");
          }
        } catch (error) {
          console.error("Initial authentication failed:", error);
          messageArea.textContent = `Authentication error: ${error.message}`;
        }
      };
      
      authenticateUser();


      // 3. User Login Logic
      window.handleLogin = async (e) => {
        e.preventDefault();
        
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        
        const email = usernameInput.value;
        const password = passwordInput.value;
        
        messageArea.textContent = 'Logging in...';
        messageArea.style.color = 'var(--primary)';

        if (!email || !password) {
            messageArea.textContent = 'Please enter both username and password.';
            messageArea.style.color = 'var(--danger)';
            return;
        }

        try {
          // Firebase function to sign in with email and password
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          
          messageArea.textContent = 'Login successful! Redirecting to dashboard...';
          messageArea.style.color = 'var(--primary-light)';
          
          // Use a small delay before redirecting to allow the user to see the success message
          setTimeout(() => {
              // In a real application, you would redirect the user to a dashboard page, e.g.,
              // window.location.href = "dashboard.html";
              alert(`Welcome back, User ${userCredential.user.uid}! (Dashboard link is currently placeholder)`);
              messageArea.textContent = 'Redirect prevented in demo: Login success.';
          }, 1500);

        } catch (error) {
          console.error("Login failed:", error);
          let errorMessage = 'Login failed. Please check your credentials.';

          // Provide friendlier error messages
          if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
            errorMessage = 'Invalid username or password.';
          } else if (error.code === 'auth/invalid-email') {
            errorMessage = 'The email address is badly formatted.';
          }
          
          messageArea.textContent = errorMessage;
          messageArea.style.color = 'var(--danger)';
        }
      };

      // Dummy implementation for alert since real alert is restricted
      function alert(message) {
          const alertDiv = document.createElement('div');
          alertDiv.style.cssText = `
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              /* Light theme for alert */
              background: var(--light); 
              color: var(--dark);
              padding: 20px;
              border-radius: var(--radius);
              box-shadow: 0 10px 20px rgba(0,0,0,0.3);
              border: 2px solid var(--accent-color);
              z-index: 9999;
              text-align: center;
              max-width: 90%;
          `;
          alertDiv.innerHTML = `
              <p style="margin-bottom: 15px;">${message}</p>
              <button onclick="this.parentNode.remove()" style="
                  /* Inherit button styles for consistency */
                  background: linear-gradient(90deg, var(--accent-color) 0%, var(--primary-light) 100%);
                  color: var(--dark);
                  padding: 8px 15px;
                  font-size: 14px;
                  font-weight: 600;
                  border: none;
                  border-radius: var(--radius-sm);
                  cursor: pointer;
              ">OK</button>
          `;
          document.body.appendChild(alertDiv);
      }
      window.alert = alert; // Override window.alert
      
    </script>
  </body>
</html>
